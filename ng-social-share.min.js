"use strict";!function(e){function o(e,o){o=o&&o.toLowerCase();for(var t="",n=0,r="a"==o?10:0,i="n"==o?10:62;n++<e;){var c=Math.random()*(i-r)+r<<0;t+=String.fromCharCode(c+=c>9?36>c?55:61:48)}return t}function t(e,o,t){var n=document.getElementById(o);return o&&n?(t&&t(),n):(console.log(e),n=document.createElement("script"),n.id=o,n.type="text/javascript",n.async=!0,n.src=e,n.onload=t,document.body.appendChild(n),n)}var n,r=e.module("educ.ngSocialShare",[]),i={},c="en_US",a=!0,l={facebook:function(e,o,n){t("https://connect.facebook.net/"+o+"/all.js","facebook-sdk",function(){window.fbAsyncInit||(window.fbAsyncInit=function(){window.FB.init({appId:e,channelUrl:"app/channel.html",status:!0,xfbml:!0})}),n&&n()})},googleplus:function(e,o,n){window.___gcfg||(window.___gcfg={lang:o.replace("_","-").toLocaleLowerCase()}),t("https://apis.google.com/js/platform.js","googleplus-sdk",n)},twitter:function(e,o,t){t&&t()}};r.provider("socialShare",function(){this.$get=[function(){}],this.setLocale=function(e){return c=e,this},this.setNeedShares=function(e){return a=!!e,this},this.register=function(e,o){return i[e]=o,this}}),r.run(["$http",function(e){n=function(){return{getFacebookCount:function(e,o){t("https://graph.facebook.com/?id="+encodeURIComponent(e)+"&callback="+encodeURIComponent(o),o)},getTwitterCount:function(e,o){t("http://urls.api.twitter.com/1/urls/count.json?url="+encodeURIComponent(e)+"&callback="+encodeURIComponent(o),o)},getGooglePlusCount:function(o,t){e.post("https://clients6.google.com/rpc?key="+encodeURIComponent(i.googleplus),{data:{method:"pos.plusones.get",id:"p",params:{nolog:!0,id:o,source:"widget",userId:"@viewer",groupId:"@self"},jsonrpc:"2.0",key:"p",apiVersion:"v1"}}).success(function(e){e.data?e.data.result?(console.error(t,e.data.result),window[t](e.data.result,null)):e.data.error&&(console.error(t,e.data.error),window[t](null,e.data.error)):console.error(t,e)}).error(function(e){console.error(t,e),window[t](null,e)})}}}()}]),r.directive("facebookShare",["$timeout",function(t){return{scope:!0,link:function(r,u,s){l.facebook(i.facebook,c),a&&s.$observe("url",function(){if(s.url){var e="facebook_jsonp_"+o(10,"a");window[e]=function(e,o,n,r){return function(o){t(function(){e.facebook=o,e.facebook.shares=e.facebook.shares||0,delete window[r],document.getElementById(r).remove()})}}(r,u,s,e),n.getFacebookCount(s.url,e)}}),u.off(),u.on("click",function(o){s.url&&window.FB&&window.FB.ui({method:"share_open_graph",action_type:"share",action_properties:JSON.stringify({object:{scrape:e.isDefined(s.scrape)?"false"!==s.scrape:!0,url:s.url,title:s.title||s.url,image:s.image||"",description:s.description||""}})},function(e){e&&e.error&&console.error("Facebook error : "+e.error.message)}),o.stopPropagation(),o.preventDefault()})}}}]),r.directive("twitterShare",["$timeout",function(t){return{scope:!0,link:function(r,i,l){function u(o,t){var n=[];for(var r in o)if(o.hasOwnProperty(r)){var i=t?t+"["+r+"]":r,c=o[r];n.push(e.isObject(c)?u(c,i):encodeURIComponent(i)+"="+encodeURIComponent(c))}return n.join("&")}function s(e,o,t,n,r){var i=0,c=0,a=0,l=0;window.screenX?(i=parseInt(window.screenX),c=parseInt(window.screenY),a=parseInt(window.outerWidth),l=parseInt(window.outerHeight)):window.screen&&(i=0,c=0,a=parseInt(window.screen.width),l=parseInt(window.screen.height)),t=t?parseInt(t):Math.round(a/2),n=n?parseInt(n):Math.round(l/2),r=r||"";var u=i;a>t&&(u+=Math.round((a-t)/2));var s=c;return l>n&&(s+=Math.round((l-n)/2)),window.open(e,o,"left="+u+"px,top="+s+"px,width="+t+"px,height="+n+"px"+r)}var p="en";switch(c){case"fr_FR":p="fr";break;case"en_US":p="en"}a&&l.$observe("url",function(){if(l.url){var e="twitter_jsonp_"+o(10,"a");window[e]=function(e,o,n,r){return function(o){t(function(){e.twitter=o,e.twitter.count=e.twitter.count||0,delete window[r],document.getElementById(r).remove()})}}(r,i,l,e),n.getTwitterCount(l.url,e)}}),i.off(),i.on("click",function(e){if(l.url){var o={lang:p,url:l.url||"",text:l.text||""};l.via&&(o.via=l.via),l.hashtags&&(o.hashtags=l.hashtags);var t="http://twitter.com/share?"+u(o);s(t,"twitter",640,400)}e.preventDefault(),e.stopPropagation()})}}}]),r.directive("googleplusShare",[function(){return{scope:!0,link:function(e,t,r){a&&r.$observe("contenturl",function(){if(r.contenturl){var i="googleplus_jsonp_"+o(10,"a");window[i]=function(e,o,t,n){return function(o,t){e.googleplus=o,delete window[n]}}(e,t,r,i),n.getGooglePlusCount(r.url,i)}});var u=function(e,o,t){return function(){if(window.gapi){var e={};e.clientid=i.googleplus,e.contenturl=t.contenturl||"",e.calltoactionlabel=t.calltoactionlabel||"",e.calltoactionurl=t.calltoactionurl||"",e.prefilltext=t.prefilltext||"",e.cookiepolicy=t.cookiepolicy||"single_host_origin",e.onshare=function(e){console.log("onshare",e)},window.gapi.interactivepost.render(o.get(0),e)}}}(e,t,r);l.googleplus(i.googleplus,c,u),r.$observe("contenturl",u),r.$observe("calltoactionurl",u),r.$observe("calltoactionlabel",u),r.$observe("prefilltext",u)}}}])}(angular);